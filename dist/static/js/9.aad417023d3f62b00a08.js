webpackJsonp([9],{FcVo:function(e,t,i){"use strict";function a(e){i("RFOX")}Object.defineProperty(t,"__esModule",{value:!0});var s=i("oMCY"),n=i("gpZA"),o=i("VU/8"),r=a,c=o(s.a,n.a,!1,r,"data-v-c9d48c7a",null);t.default=c.exports},RFOX:function(e,t,i){var a=i("aRa2");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);i("rjj0")("5c525240",a,!0,{})},aRa2:function(e,t,i){t=e.exports=i("FZ+f")(!1),t.push([e.i,".van-pull-refresh-me[data-v-c9d48c7a]{min-height:18.75rem}.chat-container[data-v-c9d48c7a]{box-sizing:border-box;width:23.4375rem;margin:0 auto}.un-login-container[data-v-c9d48c7a]{width:23.4375rem;height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;position:fixed;z-index:10;background:url(https://chachaimg.s3.us-west-1.amazonaws.com/web/omega/un-login-bg.png) no-repeat;background-size:100% auto}.chat-go-login[data-v-c9d48c7a]{background-color:#fff;position:absolute;z-index:20;top:45%;left:50%;transform:translate(-50%,-50%);border-radius:1.25rem;width:19.375rem;display:flex;flex-direction:column;align-items:center}.chat-go-login .text[data-v-c9d48c7a]{margin-top:2.875rem;width:17.125rem;font-size:1rem;font-weight:600;text-align:center;color:#000}.chat-go-login .login-button[data-v-c9d48c7a]{margin-top:2.125rem;margin-bottom:1rem;width:18.125rem;height:2.875rem;border-radius:1.4375rem;display:flex;align-items:center;justify-content:center;background-color:#ffe300;font-size:1.125rem;font-weight:700;color:#000}.title-container[data-v-c9d48c7a]{width:23.4375rem;padding:1rem 1.5625rem;top:0;position:fixed;z-index:10;background-color:#fff;box-sizing:border-box}.m-t-114[data-v-c9d48c7a]{margin-top:7.125rem}.title[data-v-c9d48c7a]{height:1.875rem;line-height:1.875rem;position:relative;font-size:1.25rem;font-weight:700;color:#000}.nav[data-v-c9d48c7a]{margin:1rem 0 0;height:2.25rem;border-radius:1.125rem;background-color:#eee;display:flex}.nav .text[data-v-c9d48c7a]{font-weight:700;color:#000;height:2.25rem;text-align:center;line-height:2.25rem;width:10.9375rem;-moz-user-select:none;-webkit-user-select:none}.nav .active-tab[data-v-c9d48c7a]{background:#ffe300;border-radius:1.125rem}.message-list .item[data-v-c9d48c7a]{padding:0 1.5625rem;box-sizing:border-box;height:5rem;display:flex;align-items:center;position:relative}.message-list .item .left[data-v-c9d48c7a]{width:3.75rem;height:3.75rem;margin-right:.625rem}.message-list .item .left .avatar[data-v-c9d48c7a]{width:100%;height:100%;border-radius:50%;object-fit:cover}.message-list .item .middle[data-v-c9d48c7a]{width:9.375rem}.message-list .item .middle .name[data-v-c9d48c7a]{width:100%;font-size:1rem;font-weight:600;text-align:left;color:#000;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.message-list .item .middle .message[data-v-c9d48c7a]{width:100%;margin-top:.625rem;font-size:.875rem;font-weight:500;text-align:left;color:#a8a8a8;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.message-list .item .right[data-v-c9d48c7a]{position:absolute;right:1.25rem;width:7.5rem;display:flex;flex-direction:column;align-items:flex-end}.message-list .item .right .time[data-v-c9d48c7a]{font-size:.75rem;font-weight:500;text-align:right;color:#a8a8a8}.message-list .item .right .unread-count[data-v-c9d48c7a]{margin-top:.8125rem;height:.875rem;min-width:.875rem;padding:.125rem;display:inline-flex;align-items:center;justify-content:center;border-radius:.4375rem;font-size:.625rem;font-weight:700;color:#fff}.you-like-list[data-v-c9d48c7a]{min-height:25rem}.you-like-list .item[data-v-c9d48c7a]{padding:0 1.625rem;box-sizing:border-box;height:5rem;display:flex;align-items:center;position:relative}.you-like-list .item .left[data-v-c9d48c7a]{width:3.75rem;height:3.75rem;margin-right:.875rem}.you-like-list .item .left .avatar[data-v-c9d48c7a]{width:100%;height:100%;border-radius:50%;object-fit:cover}.you-like-list .item .middle .name[data-v-c9d48c7a]{width:12.5rem;font-size:1rem;font-weight:600;text-align:left;color:#000;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.you-like-list .item .middle .status[data-v-c9d48c7a]{display:flex;align-items:center}.you-like-list .item .middle .status .icon[data-v-c9d48c7a]{width:.5rem;height:.5rem;border-radius:50%;background-color:#0feaa9;margin-right:.375rem}.you-like-list .item .middle .status .text[data-v-c9d48c7a]{font-size:.75rem;font-weight:500;text-align:center;color:#000}.you-like-list .item .right[data-v-c9d48c7a]{position:absolute;right:1.25rem}.you-like-list .item .right .message-icon[data-v-c9d48c7a]{width:2.5rem;height:2.5rem;margin-right:.875rem}.you-like-list .item .right .chat-icon[data-v-c9d48c7a]{width:2.5rem;height:2.5rem}.empty-container[data-v-c9d48c7a]{display:flex;flex-direction:column;align-items:center;justify-content:center}.empty-container .empty-text[data-v-c9d48c7a]{margin-top:3.75rem;width:20rem;font-size:.875rem;font-weight:500;text-align:center;color:#a8a8a8}.empty-container .to-chat[data-v-c9d48c7a]{margin-top:3.75rem;width:11.25rem;height:3.125rem;display:flex;align-items:center;justify-content:center;border-radius:1.5625rem;font-size:1rem;background-color:#ffe300;font-weight:700;text-align:center;color:#000}.bg-red[data-v-c9d48c7a]{background-color:#fb4369}",""])},gpZA:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"chat-container"},[e.isLogin?i("div",[i("div",{staticClass:"title-container"},[i("div",{staticClass:"title"},[e._v(e._s(e.localize.string_global_Chat))]),e._v(" "),i("div",{staticClass:"nav"},[i("div",{class:["text","message"===e.chatListSelectTab?"active-tab":""],on:{click:function(t){e.clickMessageTab(1)}}},[e._v(e._s(e.localize.string_global_message||"Message"))]),e._v(" "),i("div",{class:["text","youLike"===e.chatListSelectTab?"active-tab":""],on:{click:e.clickYouLikeTab}},[e._v(e._s(e.localize.string_global_following||"You like"))])])]),e._v(" "),"message"===e.chatListSelectTab?i("div",{staticClass:"m-t-114"},[e.anchorChatList.length>0?i("div",{staticClass:"message-list margin-bottom-56"},[i("van-list",{staticClass:"anchor-list-inner",attrs:{finished:!e.anchorChatListHasNext,"loading-text":"loading...","immediate-check":!1},on:{load:e.onMessageBottom},model:{value:e.messageLoading,callback:function(t){e.messageLoading=t},expression:"messageLoading"}},e._l(e.anchorChatList,function(t){return i("div",{key:t.im_conv_id,on:{click:function(i){e.goChatDetail(t)}}},[e.messageMaps[t.im_conv_id]&&e.messageMaps[t.im_conv_id][0]?i("div",{staticClass:"item"},[i("div",{staticClass:"left"},[i("img",{staticClass:"avatar",attrs:{src:t.conversation_user.icon}})]),e._v(" "),i("div",{staticClass:"middle"},[i("div",{staticClass:"name"},[e._v(e._s(t.conversation_user.first_name))]),e._v(" "),i("div",{staticClass:"message"},[1==e.messageMaps[t.im_conv_id][0].parameter.message_type?i("span",[e._v("[Pic]")]):2==e.messageMaps[t.im_conv_id][0].parameter.message_type?i("span",[e._v("[Video]")]):i("span",[e._v(e._s(e.messageMaps[t.im_conv_id][0].content||""))])])]),e._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"time"},[e._v(e._s(e.formatDate(e.messageMaps[t.im_conv_id][0].created_at||-1)))]),e._v(" "),e.unReadMessageMaps[t.im_conv_id]?i("div",{class:["unread-count",e.unReadMessageMaps[t.im_conv_id]?"bg-red":""]},[e._v(e._s(e.unReadMessageMaps[t.im_conv_id]>99?"99+":e.unReadMessageMaps[t.im_conv_id]))]):e._e()])]):e._e()])}))],1):i("div",{staticClass:"empty-container"},[i("div",{staticClass:"empty-text"},[e._v(e._s(e.localize.string_message_null))]),e._v(" "),i("div",{staticClass:"to-chat",on:{click:e.goOmegaClub}},[e._v(e._s(e.localize.string_message_null_guide))])])]):i("div",{staticClass:"m-t-114"},[i("van-pull-refresh",{staticClass:"van-pull-refresh-me",attrs:{"loading-text":"loading...","pulling-text":"Pull to refresh","loosing-text":"Release to refresh","success-text":"succeed"},on:{refresh:e.onRefresh},model:{value:e.refreshing,callback:function(t){e.refreshing=t},expression:"refreshing"}},[e.youLikeList.length>0?i("div",{staticClass:"you-like-list margin-bottom-56"},[i("van-list",{attrs:{finished:e.youLikeOnBottom,"loading-text":"loading...","immediate-check":!1},on:{load:e.youLikeBottom},model:{value:e.youLikeLoading,callback:function(t){e.youLikeLoading=t},expression:"youLikeLoading"}},e._l(e.youLikeList,function(t,a){return i("div",{key:a,staticClass:"item"},[i("div",{staticClass:"left"},[i("img",{staticClass:"avatar",attrs:{src:t.icon},on:{click:function(i){e.clickYouLikeAvatar(t)}}})]),e._v(" "),i("div",{staticClass:"middle",on:{click:function(i){e.clickYouLikeAvatar(t)}}},[i("div",{staticClass:"name"},[e._v(e._s(t.first_name)+", "+e._s(t.age))]),e._v(" "),i("div",{staticClass:"status"},[i("div",{staticClass:"icon"}),e._v(" "),i("div",{staticClass:"text"},[e._v("avaliable")])])]),e._v(" "),i("div",{staticClass:"right"},[i("img",{staticClass:"message-icon",attrs:{src:"https://chachaimg.s3.us-west-1.amazonaws.com/web/omega/message-icon.png"},on:{click:function(i){e.youLikeGoChatDetail(t)}}})])])}))],1):i("div",{staticClass:"empty-container"},[i("div",{staticClass:"empty-text"},[e._v(e._s(e.localize.string_following_null))]),e._v(" "),i("div",{staticClass:"to-chat",on:{click:e.goOmegaClub}},[e._v(e._s(e.localize.string_following_null_guide))])])])],1)]):i("div",{staticClass:"un-login-container"},[i("div",{staticClass:"chat-go-login"},[i("div",{staticClass:"text"},[e._v(e._s(e.localize.string_message_unlogin))]),e._v(" "),i("div",{staticClass:"login-button",on:{click:e.handleLogin}},[e._v(e._s(e.localize.string_login))])])]),e._v(" "),i("tab-bar"),e._v(" "),e.isLogin?e._e():i("register-pop",{ref:"register",on:{loginSuccessCallback:e.handleLoginSuccess}}),e._v(" "),e.isShowVideoDetail?i("anchor-detail",{ref:"videoDetail",on:{privateCall:e.detailPrivateCall}}):e._e(),e._v(" "),i("anchor-video",{ref:"anchorVideo",on:{showUserMedia:e.handleUserMedia}}),e._v(" "),i("user-media-pop",{ref:"userMediaPop"})],1)},s=[],n={render:a,staticRenderFns:s};t.a=n},oMCY:function(e,t,i){"use strict";var a=i("Gu7T"),s=i.n(a),n=i("Dd8w"),o=i.n(n),r=i("Xxa5"),c=i.n(r),l=i("exGp"),d=i.n(l),m=i("/qoh"),g=i("TvvI"),u=i("z5Hi"),h=i("dn3/"),v=i("WzBM"),_=i("U4zD"),f=i("k+Rk"),p=i("yt7g"),k=i("BK/k"),L=i("2sBs"),w=i.n(L),C=i("NYxO"),b=i("OzXt"),x=i.n(b);t.a={data:function(){return{youLikeLoading:!1,youLikeOnBottom:!1,messageLoading:!1,messageFinished:!1,isShowVideoDetail:!1,isShowGoLogin:!0,youLikeList:[],localize:x.a,isLogin:!1,refreshing:!1,page:0}},components:{TabBar:m.default,RegisterPop:g.default,AnchorDetail:u.a,AnchorVideo:h.a,UserMediaPop:v.default},activated:function(){"youLike"===this.chatListSelectTab&&this.$store.commit("UPDATE_CHAT_LIST_SELECT_TAB","message"),this.isLogin=i.i(p.a)("isHasLogin")},deactivated:function(){this.replaceAnchorSendMessageTimer&&(clearTimeout(this.replaceAnchorSendMessageTimer),this.replaceAnchorSendMessageTimer=null)},watch:{anchorChatList:function(e){var t=this;return d()(c.a.mark(function a(){var s,n;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.isLogin&&0==e.length&&"M"==i.i(p.a)("UserInfo").gender&&(s=i.i(p.a)("currentDate")||i.i(p.g)(),n=i.i(p.a)("currentAnchorSendMessageCount")||0,s&&s==i.i(p.g)()||(n=0),(!s||n<10)&&(t.replaceAnchorSendMessageTimer=setTimeout(function(){console.log("消息列表页消息代发了"),0==t.$api.talentStart().result&&(i.i(p.d)("currentDate",s),i.i(p.d)("currentAnchorSendMessageCount",++n)),clearTimeout(t.replaceAnchorSendMessageTimer),t.replaceAnchorSendMessageTimer=null},1e4)));case 1:case"end":return a.stop()}},a,t)}))()}},computed:o()({},i.i(C.b)(["anchorChatList","messageMaps","unReadMessageMaps","chatListSelectTab","conversationList","anchorChatListHasNext","anchorChatListPageCursor"])),created:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:window.addEventListener("beforeunload",function(e){window.scroll(0,0)}),e.isLogin=i.i(p.a)("isHasLogin"),e.isLogin&&(e.createSocketPage(i.i(p.a)("UserInfo")),e.getMyFollowList());case 3:case"end":return t.stop()}},t,e)}))()},methods:{getMyFollowList:function(){var e=this;return d()(c.a.mark(function t(){var i,a,n,o,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.youLikeLoading=!0,t.next=4,e.$api.getMyFollow({page:e.page,pageSize:20});case 4:i=t.sent,a=i.data,n=i.result,o=i.message,e.youLikeLoading=!1,0==n?(0==e.page?e.youLikeList=a.list:(r=e.youLikeList).push.apply(r,s()(a.list)),a.list<20&&(e.youLikeOnBottom=!0),e.page++):e.$toast(o),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),e.youLikeLoading=!1;case 15:case"end":return t.stop()}},t,e,[[0,12]])}))()},clickYouLikeAvatar:function(e){var t=this;this.isShowVideoDetail?this.$refs.videoDetail.show([e],0):(this.isShowVideoDetail=!0,this.$nextTick(function(){t.$refs.videoDetail.show([e],0)}))},handleLogin:function(){this.$reportAnalyticsFun("MESSAGE_SIGNUP_CLICK"),this.$refs.register.handleRegisterPopup(!0,"chat")},handleLoginSuccess:function(e){this.isLogin=!0,this.createSocketPage(e)},formatDate:p.e,createSocketPage:function(e){this.rwSocketClient=i.i(f.b)(k.a.socketUrl+"?"+w()({accessToken:e.im_token,platform:k.b,sdkVersion:k.c}),this)},clickMessageTab:function(){"message"!==this.chatListSelectTab&&(this.$store.commit("UPDATE_CHAT_LIST_SELECT_TAB","message"),this.$reportAnalyticsFun("CHAT_TAB_ENTER"))},clickYouLikeTab:function(){"youLike"!==this.chatListSelectTab&&(this.$store.commit("UPDATE_CHAT_LIST_SELECT_TAB","youLike"),this.page=0,this.getMyFollowList(),this.$reportAnalyticsFun("YOU_LIKE_ENTER"))},onRefresh:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.page=0,t.next=4,e.getMyFollowList();case 4:e.refreshing=!1,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e.refreshing=!1;case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},onMessageBottom:function(){var e=this;return d()(c.a.mark(function t(){var a,s,n,o,r,l;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.anchorChatListHasNext){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.$api.getConversationList({page_cursor:e.anchorChatListPageCursor});case 5:a=t.sent,s=a.result,n=a.data,0==s&&(e.messageLoading=!1,o=[],r=[],n.conversation_list.forEach(function(t){if(t.conversation_user.id>100)o.push(t),r[t.im_conv_id]=1;else{var a=i.i(_.a)(t.im_conv_id);e.rwSocketClient.send(a),e.$store.commit("UPDATE_UN_READ_MESSAGE_MAPS",t.im_conv_id)}}),e.$store.commit("API_GET_ANCHOR_CHAT_LIST",{list:o,conversationIdMap:r,has_next:n.has_next,page_cursor:n.page_cursor}),l=i.i(_.b)(),e.rwSocketClient.send(l),o.forEach(function(t){var a=i.i(_.c)(t.im_conv_id);e.rwSocketClient.send(a)})),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),e.messageLoading=!1;case 14:case"end":return t.stop()}},t,e,[[2,11]])}))()},youLikeBottom:function(){var e=this;return d()(c.a.mark(function t(){return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e.getMyFollowList();case 1:case"end":return t.stop()}},t,e)}))()},goOmegaClub:function(){this.$router.push("/omegaClub?tab=all")},youLikeGoChatDetail:function(e){var t=this;return d()(c.a.mark(function a(){var s,n,o,r,l,d,m,g;return c.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,s=e,s.im_conv_id){a.next=27;break}return t.$showLoading({needBg:!1}),a.next=6,t.$api.getTargetsRelation({fields:["conv_info"],target_uids:[s.id]});case 6:if(n=a.sent,o=n.data,r=void 0===o?{}:o,l=n.result,d=n.message,0!=l){a.next=25;break}if(r.list[0].conv_info){a.next=20;break}return a.next=15,t.$api.createConversation({target_uid:s.id,source:"flow"});case 15:m=a.sent,t.$hideLoading(),0==m.result&&(s.im_conv_id=m.data.conversation.im_conv_id,s.conv_id=m.data.conversation.conv_id,t.$store.commit("SAVE_AUTO_SEND_MESSAGE","hi"),t.$reportAnalyticsFun("CONVO_CREATE",{source:"following",receiver_id:m.data.conversation.id})),a.next=23;break;case 20:g=r.list[0].conv_info||{},s.im_conv_id=g.im_conv_id,s.conv_id=g.conv_id;case 23:a.next=27;break;case 25:t.$hideLoading(),t.$toast(d);case 27:t.$hideLoading(),s.is_favourite=1,i.i(p.d)("currentChatAnchorDetail",s),t.$store.commit("SAVE_CURRENT_ANCHOR_DETAIL",s),t.$store.commit("UPDATE_ANCHOR_CHAT_LIST",{conversation_user:s,im_conv_id:s.im_conv_id}),t.$store.commit("UPDATE_CHAT_DETAIL",s.im_conv_id),t.$router.push("/chatDetail"),a.next=40;break;case 36:a.prev=36,a.t0=a.catch(0),console.log(a.t0),t.$hideLoading();case 40:case"end":return a.stop()}},a,t,[[0,36]])}))()},detailPrivateCall:function(e){e.enterSource="convo",this.$refs.anchorVideo.privateCall(e)},handleUserMedia:function(){this.$refs.userMediaPop.changePopStatus(!0)},goChatDetail:function(e){try{if(e.conversation_user.im_conv_id=e.im_conv_id,e.conversation_user.conv_id=e.conv_id,i.i(p.d)("currentChatAnchorDetail",e.conversation_user),this.$store.commit("UPDATE_CHAT_DETAIL",e.im_conv_id),this.$store.commit("SAVE_CURRENT_ANCHOR_DETAIL",e.conversation_user),this.$store.commit("UPDATE_CURRENT_DETAIL_PAGE",!0),this.unReadMessageMaps[e.im_conv_id]>0){var t=i.i(_.a)(e.im_conv_id);this.rwSocketClient.send(t),this.$store.commit("UPDATE_UN_READ_MESSAGE_MAPS",e.im_conv_id)}this.$router.push("/chatDetail")}catch(e){console.warn(e),this.$router.push("/chatDetail")}}}}}});